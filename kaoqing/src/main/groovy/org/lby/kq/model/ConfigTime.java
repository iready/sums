package org.lby.kq.model;

import com.jfinal.plugin.activerecord.Db;
import com.jfinal.plugin.activerecord.IAtom;
import com.jfinal.plugin.activerecord.Record;
import org.lby.kq.common.SysVar;
import org.lby.kq.model.base.BaseConfigTime;
import org.lby.kq.model.common.Manage_;

import java.sql.SQLException;
import java.util.List;

/**
 * Generated by JFinal.
 */
@SuppressWarnings("serial")
public class ConfigTime extends BaseConfigTime<ConfigTime> implements SysVar {
    public static final ConfigTime dao = new ConfigTime();

    /**
     * @param email
     */
    public List<Record> find_by_email(String email) {
        return Db.find("select * from " + TABLENAME + " where provider=? order by createTime desc", email);
    }

    public List<Record> find_by_fy(String fy) {
        return Db.find("select kct.*,kbcu.unitType,kbcu.unitName from kq_bridge_config_unit kbcu LEFT JOIN kq_config_time kct on kbcu.confId=kct.id where kbcu.unitType=0 and kbcu.unit  " + Manage_.query_previw(role_qx, fy));
    }


    public void deleteById(final String id) {
        Db.tx(new IAtom() {
            @Override
            public boolean run() throws SQLException {
                ConfigTime configTime = ConfigTime.dao.findById(id);
                BridgeConfigUnit.dao.clean_by_config(configTime);
                configTime.delete();
                return false;
            }
        });
    }
}
